---
title: "Diet_4mo_Physiology"
author: "Michael Sieler"
date: "2022-12-09"
output: html_document
---

This document contains analyses related to the 4 month sampling timepoint comparing physiology of control fish fed the three diets. 


```{r}

knitr::opts_chunk$set(
  echo = FALSE,
  cache = FALSE,
  warning = FALSE,
  message = FALSE, 
  # fig.width = 5, fig.height = 5,
  dpi = 300
)



```


## Global Variables

This chunk of code grabs the relevant data frames/tables generated from the `microbiomeProcessing.R` script for analysis.

```{r}

data <- df.T0
data.alpha <- dt.alphaPlus.T0.melt
ps.obj <- ps.T0
dist <- distList.T0
# data.diffAb <- diffAb.conT0

levels(data.alpha$Diet) <- factor(levels(data.alpha$Diet), levels = c("Gemma", "Watts", "ZIRC"))
data.alpha$Diet <- relevel(factor(data.alpha$Diet), ref = "Gemma")

```


### Physiology

This chunk of code outputs figures generated in subsequent chunks into relavent figure folder.

```{r}
# Plot output settings
tmp.path <- "gg_Record/Diet_4moCtrl/Physiology"
gg_record(dir = file.path(path.figures, tmp.path),
          device = "png",
          width = 5,
          height = 5,
          units = "in"
          )

```


#### Weight

##### Diet


```{r Diet-Physio-Weight}

test <- data %>%
  rstatix::wilcox_test(data =., Weight ~ Diet) %>%
  rstatix::adjust_pvalue(method = "BH") %>%
  rstatix::add_significance("p.adj")

Fig.1.a <- 
  data %>%
    ggplot(aes(x = Diet, 
               y = Weight
               )) +
    geom_boxplot(aes(fill = Diet)) +
    geom_quasirandom(size = 1) +
    scale_fill_manual(values = pal.Dark2) +
    scale_color_manual(values = pal.Dark2) + 
    labs(
      x = "Diet",
      y = "Weight (mg)"
    ) +
    ggpubr::stat_pvalue_manual(test, 
                               label = "p.adj.signif", 
                               size = 6,
                               bracket.size = 1,
                               y.position = c(325, 510, 425)) +
    scale_y_continuous(breaks = scales::breaks_pretty(n = 5), 
                       limits = c(0, 525)) + 
  theme(legend.position = "none")


Fig.1.a

test %>% 
  flextable() %>%
  align(j = 3:6, align = "right") %>%
  colformat_double(j = 6:7, digits = 3) %>%
  merge_v(j = 1) %>%
  set_formatter(values = list("p" = p_val_format,
                              "p.adj" = p_val_format) ) %>%
  set_caption(paste0("Wilcoxon Test. p. adj: BH. Weight ~ Diet")) %>%
  autofit() %>%
  save_as_image(path = file.path(path.figures, tmp.path, "WilcoxonTest_Weight-Diet_4moCtrl.png"))


```

##### (SM) Sex

```{r Sex-Physio-Weight}

test <- data %>%
  rstatix::wilcox_test(data =., Weight ~ Sex) %>%
  rstatix::adjust_pvalue(method = "BH") %>%
  rstatix::add_significance("p.adj")

Supp.Fig.1.a <- 
  data %>%
    ggplot(aes(x = Sex, 
               y = Weight
               )) +
    geom_boxplot(aes(fill = Sex)) +
    scale_fill_manual(values = pal.Dark2) +
    scale_color_manual(values = pal.Dark2) + 
    labs(
      x = "Diet",
      y = "Weight (mg)"
    ) +
    ggpubr::stat_pvalue_manual(test, 
                               label = "p.adj.signif", 
                               size = 6,
                               bracket.size = 1,
                               y.position = c(500)) +
    scale_y_continuous(breaks = scales::breaks_pretty(n = 5), 
                       limits = c(0, 525)) + 
  theme(legend.position = "none")


Supp.Fig.1.a

test %>% 
  flextable() %>%
  align(j = 3:6, align = "right") %>%
  colformat_double(j = 6:7, digits = 3) %>%
  merge_v(j = 1) %>%
  set_formatter(values = list("p" = p_val_format,
                              "p.adj" = p_val_format) ) %>%
  set_caption(paste0("Wilcoxon Test. p. adj: BH. Weight ~ Sex")) %>%
  autofit() %>%
  save_as_image(path = file.path(path.figures, tmp.path, "WilcoxonTest_Weight-Sex_4moCtrl.png"))


```

#### Weight ~ Diet*Sex


```{r Diet-Physio-Weight}

test <- data %>%
  group_by(Sex) %>%
  rstatix::wilcox_test(data =., Weight ~ Diet) %>%
  rstatix::adjust_pvalue(method = "BH") %>%
  rstatix::add_significance("p.adj")

# # Fig.1.a <-
#   data %>%
#     ggplot(aes(x = Diet,
#                y = Weight,
#                # fill = Sex
#                )) +
#     geom_boxplot(aes(fill=Sex)) +
#     geom_quasirandom(aes(fill=Sex), shape = 21, dodge.width=.75) +
#     # facet_grid(as.formula(paste0(facet.var.y, " ~ ", facet.var.x)), scales = "free_y") +
#     scale_fill_manual(values = pal.Dark2) +
#     scale_color_manual(values = pal.Dark2) +
#     labs(
#       # title = "",
#       # caption = "",
#       x = "Diet",
#       y = "Weight (mg)"
#     ) +
#     ggpubr::stat_pvalue_manual(test,
#                                label = "p.adj.signif",
#                                size = 6,
#                                bracket.size = 1,
#                                y.position = c(325, 510, 425)
#                                ) +
#     scale_y_continuous(breaks = scales::breaks_pretty(n = 5),
#                        limits = c(0, 525)) +
#   theme(legend.position = "bottom")


# Fig.1.a

test %>%
  flextable() %>%
  align(j = 3:6, align = "right") %>%
  colformat_double(j = 6:7, digits = 3) %>%
  merge_v(j = 1) %>%
  set_formatter(values = list("p" = p_val_format,
                              "p.adj" = p_val_format) ) %>%
  set_caption(paste0("Wilcoxon Test. p. adj: BH. Weight ~ Diet")) %>%
  autofit() %>%
  save_as_image(path = file.path(path.figures, tmp.path, "WilcoxonTest_Weight-Diet_4moCtrl.png"))


```

#### BCS ~ Diet*Sex


```{r Diet-Physio-Weight}

test <- data %>%
  group_by(Sex) %>%
  rstatix::wilcox_test(data =., Body.Condition.Score ~ Diet) %>%
  rstatix::adjust_pvalue(method = "BH") %>%
  rstatix::add_significance("p.adj")

# 
#   data %>%
#     ggplot(aes(x = Diet,
#                y = Body.Condition.Score,
#                # fill = Sex
#                )) +
#     geom_boxplot(aes(fill=Sex)) +
#     geom_boxplot(aes(fill=Sex)) +
#     geom_quasirandom(aes(fill=Sex), shape = 21, dodge.width=.75) +
#     # facet_grid(as.formula(paste0(facet.var.y, " ~ ", facet.var.x)), scales = "free_y") +
#     scale_fill_manual(values = pal.Dark2) +
#     scale_color_manual(values = pal.Dark2) +
#     labs(
#       # title = "",
#       # caption = "",
#       x = "Diet",
#       y = "Body Condition Score"
#     ) +
#     ggpubr::stat_pvalue_manual(test,
#                                label = "p.adj.signif",
#                                size = 6,
#                                bracket.size = 1,
#                                y.position = c(2.75, 3, 3.25)
#                                ) +
#     scale_y_continuous(breaks = scales::breaks_pretty(n = 5),
#                        limits = c(1, 3.25)) +
#   theme(legend.position = "bottom")
# 



test %>%
  flextable() %>%
  align(j = 3:6, align = "right") %>%
  colformat_double(j = 6:7, digits = 3) %>%
  merge_v(j = 1) %>%
  set_formatter(values = list("p" = p_val_format,
                              "p.adj" = p_val_format) ) %>%
  set_caption(paste0("Wilcoxon Test. p. adj: BH. Weight ~ Diet*Sex")) %>%
  autofit()


```


#### Body Condition Score

##### Diet

```{r Diet-Physio-BCS}
test <- data %>%
  rstatix::wilcox_test(data =., Body.Condition.Score ~ Diet) %>%
  rstatix::adjust_pvalue(method = "BH") %>%
  rstatix::add_significance("p.adj")


Fig.1.b <- 
  data %>%
    ggplot(aes(x = Diet, 
               y = Body.Condition.Score
               )) +
    geom_boxplot(aes(fill = Diet)) +
    geom_quasirandom(size = 1) +
    scale_fill_manual(values = pal.Dark2) +
    scale_color_manual(values = pal.Dark2) + 
    labs(
      # title = "",
      # caption = "",
      x = "Diet",
      y = "Body Condition Score"
    ) +
    ggpubr::stat_pvalue_manual(test, 
                               label = "p.adj.signif", 
                               size = 6,
                               bracket.size = 1,
                               y.position = c(2.75, 3, 3.25)) +
    scale_y_continuous(breaks = scales::breaks_pretty(n = 5), 
                       limits = c(1, 3.25)) + 
  theme(legend.position = "none")

Fig.1.b

test %>% 
  flextable() %>%
  align(j = 3:6, align = "right") %>%
  colformat_double(j = 6:7, digits = 3) %>%
  merge_v(j = 1) %>%
  set_formatter(values = list("p" = p_val_format,
                              "p.adj" = p_val_format) ) %>%
  set_caption(paste0("Wilcoxon Test. p. adj: BH. Body.Condition.Score ~ Diet")) %>%
  autofit() %>%
  save_as_image(path = file.path(path.figures, tmp.path, "WilcoxonTest_BCS-Diet_4moCtrl.png"))

```

##### (SM) Sex

```{r Sex-Physio-Weight}

test <- data %>%
  rstatix::wilcox_test(data =., Body.Condition.Score ~ Sex) %>%
  rstatix::adjust_pvalue(method = "BH") %>%
  rstatix::add_significance("p.adj")

Supp.Fig.1.b <- 
  data %>%
    ggplot(aes(x = Sex, 
               y = Body.Condition.Score
               )) +
    geom_boxplot(aes(fill = Sex)) +
    geom_quasirandom(size = 1) +
    scale_fill_manual(values = pal.Dark2) +
    scale_color_manual(values = pal.Dark2) + 
    labs(
      # title = "",
      # caption = "",
      x = "Diet",
      y = "Body Condition Score"
    ) +
    ggpubr::stat_pvalue_manual(test, 
                               label = "p.adj.signif", 
                               size = 6,
                               bracket.size = 1,
                               y.position = c(4)) +
    scale_y_continuous(breaks = scales::breaks_pretty(n = 5), 
                       limits = c(0, 4)) + 
  theme(legend.position = "none")


Supp.Fig.1.b

test %>% 
  flextable() %>%
  align(j = 3:6, align = "right") %>%
  colformat_double(j = 6:7, digits = 3) %>%
  merge_v(j = 1) %>%
  set_formatter(values = list("p" = p_val_format,
                              "p.adj" = p_val_format) ) %>%
  set_caption(paste0("Wilcoxon Test. p. adj: BH. Body.Condition.Score ~ Sex")) %>%
  autofit() %>%
  save_as_image(path = file.path(path.figures, tmp.path, "WilcoxonTest_BCS-Sex_4moCtrl.png"))


```