---
title: "Infection"
author: "Michael Sieler"
date: "2022-12-09"
output: html_document
---

This document contains analyses related to the 4 and 7 month sampling timepoints comparing infection between fish fed the three diets. 


```{r}

knitr::opts_chunk$set(
  echo = FALSE,
  cache = FALSE,
  warning = FALSE,
  message = FALSE, 
  # fig.width = 5, fig.height = 5,
  dpi = 300
)



```

## Global Variables

This chunk of code grabs the relevant data frames/tables generated from the `microbiomeProcessing.R` script for analysis.

```{r}

data <- df.all
data.alpha <- dt.alphaPlus.all.melt
data.beta <- df.T1
data.beta2 <- df.all # Includes pre-exposure fish
ps.obj <- ps.all
dist <- distList.T1
dist2 <- distList.all



# Relevel
levels(data$PrePostExp) <- factor(levels(data$PrePostExp), levels = c("Pre-exposure", "Unexposed", "Exposed"))
data$PrePostExp <- relevel(factor(data$PrePostExp), ref = "Pre-exposure")

levels(data.alpha$PrePostExp) <- factor(levels(data.alpha$PrePostExp), levels = c("Pre-exposure", "Unexposed", "Exposed"))
data.alpha$PrePostExp <- relevel(factor(data.alpha$PrePostExp), ref = "Pre-exposure")

levels(data.beta$PrePostExp) <- factor(levels(data.beta$PrePostExp), levels = c("Exposed", "Unexposed"))
data.beta$PrePostExp <- relevel(factor(data.beta$PrePostExp), ref = "Unexposed")

levels(data.beta2$PrePostExp) <- factor(levels(data.beta2$PrePostExp), levels = c("Pre-exposure", "Unexposed", "Exposed"))
data.beta2$PrePostExp <- relevel(factor(data.beta2$PrePostExp), ref = "Pre-exposure")

levels(sample_data(ps.obj)$PrePostExp) <- factor(levels(sample_data(ps.obj)$PrePostExp),levels = c("Pre-exposure", "Unexposed", "Exposed"))
sample_data(ps.obj)$PrePostExp <- relevel(factor(sample_data(ps.obj)$PrePostExp), ref = "Pre-exposure")
# 
# levels(data.da$PrePostExp) <- factor(levels(data.da$PrePostExp), levels = c("Pre-exposure", "Unexposed", "Exposed"))
# data.da$PrePostExp <- relevel(factor(data.da$PrePostExp), ref = "Pre-exposure")



```

## Clean Variables

Presence of infection was marked as `negative`, or `positive` or `lumen only`. To simplify, we combined `lumen only` and `positive` since both indicate presence of infection.

```{r}
data <- data %>%
  # filter(PrePostExp == "Exposed") %>%
  mutate(Pathology.Results = 
           case_when(
             Pathology.Results == "negative" ~ "Negative",
             Pathology.Results == "positive" ~ "Positive",
             Pathology.Results == "lumen only" ~ "Positive"
           ))

data.alpha <- data.alpha %>%
  # filter(PrePostExp == "Exposed") %>%
  mutate(Pathology.Results = 
           case_when(
             Pathology.Results == "negative" ~ "Negative",
             Pathology.Results == "positive" ~ "Positive",
             Pathology.Results == "lumen only" ~ "Positive"
           ))

data.beta <- data.alpha %>%
  # filter(PrePostExp == "Exposed") %>%
  mutate(Pathology.Results = 
           case_when(
             Pathology.Results == "negative" ~ "Negative",
             Pathology.Results == "positive" ~ "Positive",
             Pathology.Results == "lumen only" ~ "Positive"
           ))

sample_data(ps.obj) <- sample.data.frame(ps.obj) %>%
  # filter(PrePostExp == "Exposed") %>%
  mutate(Pathology.Results = 
           case_when(
             Pathology.Results == "negative" ~ "Negative",
             Pathology.Results == "positive" ~ "Positive",
             Pathology.Results == "lumen only" ~ "Positive"
           ))



```

## Infection Counts

This chunk of code outputs figures generated in subsequent chunks into relavent figure folder.

```{r}

# Plot settings
tmp.path <- "gg_Record/Exposure/Infection"
gg_record(dir = file.path(path.figures, "gg_Record/Exposure/Infection"),
          device = "png",
          width = 5,
          height = 5,
          units = "in"
          )

```


